<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Notificador Reddit - r/PhotoshopRequest</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
      background-color: #f9f9f9;
    }
    h1 {
      color: #ff4500;
    }
    #posts {
      margin-top: 20px;
    }
    .post {
      margin: 10px auto;
      padding: 10px;
      max-width: 600px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
      text-align: left;
    }
    .post a {
      text-decoration: none;
      color: #0079d3;
    }
  </style>
</head>
<body>
  <h1>ðŸ“¢ Notificador de Novos Posts - r/PhotoshopRequest</h1>
  <div id="status">Carregando...</div>
  <div id="posts"></div>

  <script>
    const proxyUrl = "https://reddit-cors-proxy.onrender.com/?url=";
    const redditUrl = "https://www.reddit.com/r/PhotoshopRequest/new.json?limit=5";

    let lastPostId = null;

    async function verificarNovosPosts() {
      try {
        const resposta = await fetch(proxyUrl + encodeURIComponent(redditUrl));
        const dados = await resposta.json();
        const posts = dados.data.children;

        if (!posts || posts.length === 0) {
          document.getElementById("status").innerText = "Nenhum post encontrado.";
          return;
        }

        const novoPostId = posts[0].data.id;

        if (lastPostId && novoPostId !== lastPostId) {
          mostrarNotificacao(posts[0].data);
        }

        lastPostId = novoPostId;
        atualizarPosts(posts);
        document.getElementById("status").innerText = "Ãšltima verificaÃ§Ã£o: " + new Date().toLocaleTimeString();

      } catch (erro) {
        console.error("Erro ao carregar posts:", erro);
        document.getElementById("status").innerText = "Erro ao carregar os posts ðŸ˜ž";
      }
    }

    function atualizarPosts(posts) {
      const container = document.getElementById("posts");
      container.innerHTML = "";
      posts.forEach(post => {
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `<a href="https://reddit.com${post.data.permalink}" target="_blank">${post.data.title}</a>`;
        container.appendChild(div);
      });
    }

    function mostrarNotificacao(post) {
      if (Notification.permission === "granted") {
        new Notification("Novo post em r/PhotoshopRequest", {
          body: post.title,
          icon: "https://www.redditstatic.com/desktop2x/img/favicon/android-icon-192x192.png"
        });
      }
    }

    async function solicitarPermissaoNotificacao() {
      if (Notification.permission !== "granted") {
        await Notification.requestPermission();
      }
    }

    solicitarPermissaoNotificacao();
    verificarNovosPosts();
    setInterval(verificarNovosPosts, 30000); // 30 segundos
  </script>
</body>
</html>
